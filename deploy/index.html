<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintStack</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="sidebar">
        <h1>PrintStack</h1>
        <div class="nav-item active" data-page="filament">Filament Library</div>
        <div class="nav-item" data-page="models">Models Library</div>
        <div class="nav-item" data-page="prints">Print History</div>
        <div class="nav-item" data-page="stats">Statistics</div>
    </div>

    <div class="main-content">
        <div class="container">
            <div id="filament-page" class="page active">
                <h1>Filament Library</h1>
                <div class="section">
                    <h2>Import/Export Data</h2>
                    <button onclick="exportData()">Export All Data</button>
                    <button class="export-btn" onclick="document.getElementById('importFile').click()">Import Data</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>
                <div class="section">
                    <div class="section-header" onclick="toggleSection('materialTypesSection')">
                        <h2>Material Type Management</h2>
                        <span class="toggle-icon" id="materialTypesSection-toggle">â–¶</span>
                    </div>
                    <div class="section-content collapsible" id="materialTypesSection" style="max-height: 0px; overflow: hidden;">
                        <div class="material-types-management">
                            <div class="material-types-list" id="materialTypesList"></div>
                            <div class="material-types-add">
                                <input type="text" id="newMaterialType" placeholder="New material type..." maxlength="50">
                                <button onclick="handleAddMaterialType()">Add Type</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header" onclick="toggleSection('addFilamentSection')">
                        <h2>Add New Filament</h2>
                        <span class="toggle-icon" id="addFilamentSection-toggle">â–¶</span>
                    </div>
                    <div id="addFilamentSection" class="section-content collapsible" style="max-height: 0px; overflow: hidden;">
                        <form id="filamentForm" aria-label="Add new filament">
                            <div class="input-group">
                                    <div class="form-group">
                                        <label for="filamentBrand" id="filamentBrandLabel">Brand</label>
                                        <input type="text" id="filamentBrand" name="brand" placeholder="Manufacturer (e.g., eSUN, Hatchbox)" required aria-required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentMaterialType" id="filamentMaterialTypeLabel">Material Type</label>
                                        <select id="filamentMaterialType" name="materialType" required aria-required="true">
                                            <option value="">Select Type...</option>
                                            <option value="PLA">PLA</option>
                                            <option value="PETG">PETG</option>
                                            <option value="ABS">ABS</option>
                                            <option value="TPU">TPU</option>
                                            <option value="Other">Other (Custom)</option>
                                        </select>
                                        <input type="text" id="filamentMaterialTypeCustom" name="materialTypeCustom" placeholder="Custom material type" aria-label="Custom material type" style="display: none;">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentColor" id="filamentColorLabel">Color Name</label>
                                        <input type="text" id="filamentColor" name="colorName" placeholder="Color description" required aria-required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentColorHex" id="filamentColorHexLabel">Color Code</label>
                                        <input type="color" id="filamentColorHex" name="colorHex" value="#ff5733" aria-describedby="colorContrastInfo">
                                        <small id="colorContrastInfo" class="form-help">Select filament color</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentDiameter" id="filamentDiameterLabel">Diameter</label>
                                        <select id="filamentDiameter" name="diameter" required aria-required="true">
                                            <option value="1.75">1.75mm</option>
                                            <option value="2.85">2.85mm</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentWeight" id="filamentWeightLabel">Weight (g)</label>
                                        <input type="number" id="filamentWeight" name="weight" placeholder="Initial weight" min="0" required aria-required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentLocation" id="filamentLocationLabel">Storage Location</label>
                                        <input type="text" id="filamentLocation" name="location" placeholder="Storage location">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentPurchasePrice" id="filamentPurchasePriceLabel">Purchase Price ($/kg)</label>
                                        <input type="number" id="filamentPurchasePrice" name="purchasePrice" placeholder="Optional price per kg" min="0" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="filamentInStock" name="inStock" value="true" checked>
                                            In Stock?
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <fieldset>
                                            <legend>Temperature Range (Â°C)</legend>
                                            <label for="filamentTempMin" id="filamentTempMinLabel">Min Temp:</label>
                                            <input type="number" id="filamentTempMin" name="tempMin" min="150" max="350" placeholder="min">
                                            <label for="filamentTempMax" id="filamentTempMaxLabel">Max Temp:</label>
                                            <input type="number" id="filamentTempMax" name="tempMax" min="150" max="350" placeholder="max">
                                        </fieldset>
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentNotes" id="filamentNotesLabel">Notes</label>
                                        <textarea id="filamentNotes" name="notes" rows="3" placeholder="Additional notes about this filament"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" id="addFilamentBtn">Add Filament</button>
                                <button type="button" id="cancelFilamentBtn" style="display: none;">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="section">
                    <h2>Filament Inventory</h2>
                    <div id="filamentGridWrapper">
                        <div class="data-grid-controls">
                            <div class="data-grid-search">
                                <input type="text" id="filamentTableSearch" placeholder="ðŸ” Search filaments..." aria-label="Search filaments">
                            </div>
                            <div class="data-grid-pagination">
                                <button id="filamentGridPrev" disabled aria-label="Previous page">â€¹</button>
                                <span class="pagination-info" id="filamentGridInfo">0-0 of 0</span>
                                <button id="filamentGridNext" disabled aria-label="Next page">â€º</button>
                            </div>
                        </div>
                        <div class="search-results-info" id="filamentSearchResults" style="display: none;"></div>
                        <div class="table-container">
                            <table id="filamentTable" class="data-grid-table">
                                <thead>
                                    <tr>
                                        <th scope="col" data-column="brand" class="sortable-header">Brand</th>
                                        <th scope="col" data-column="materialType" class="sortable-header">Material Type</th>
                                        <th scope="col" data-column="colorName" class="sortable-header">Color</th>
                                        <th scope="col" data-column="weight" class="sortable-header">Weight (g)</th>
                                        <th scope="col" data-column="inStock" class="sortable-header">Status</th>
                                        <th scope="col" data-column="location" class="sortable-header">Location</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="filamentTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div id="duplicateWarning" class="warning-message" role="alert" aria-live="polite" style="display: none;">
                        <p>Duplicate filament detected. Would you like to merge with existing entry or create new one?</p>
                        <button id="mergeDuplicateBtn">Merge</button>
                        <button id="createNewBtn">Create New</button>
                        <button id="cancelDuplicateBtn">Cancel</button>
                    </div>
                </div>
            </div>

            <div id="models-page" class="page">
                <h1>Models Library</h1>
                <div class="section">
                    <h2>Import/Export Data</h2>
                    <button onclick="exportData()">Export All Data</button>
                    <button class="export-btn" onclick="document.getElementById('importFile2').click()">Import Data</button>
                    <input type="file" id="importFile2" accept=".json" style="display: none;">
                </div>
                <div class="section">
                    <div class="section-header" onclick="toggleSection('addModelSection')">
                        <h2>Add New Model</h2>
                        <span class="toggle-icon" id="addModelSection-toggle">â–¼</span>
                    </div>
                    <div id="addModelSection" class="section-content collapsible" style="max-height: 0px; overflow: hidden;">
                        <div class="input-group">
                            <input type="text" id="modelName" placeholder="Model Name">
                            <input type="text" id="modelLink" placeholder="Link/Notes (optional)">
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:10px;font-weight:600;color:#495057;">Required Filaments:</label>
                            <div id="requiredFilamentsContainer"></div>
                            <button type="button" class="add-req-btn" onclick="addFilamentRequirement()">+ Add Filament</button>
                        </div>
                        <button onclick="addModel()">Add Model</button>
                    </div>
                </div>

                <div class="section">
                    <h2>Model Database</h2>
                    <div id="modelGridWrapper">
                        <div class="data-grid-controls">
                            <div class="data-grid-search">
                                <input type="text" id="modelTableSearch" placeholder="ðŸ” Search models..." aria-label="Search models">
                            </div>
                            <div class="data-grid-pagination">
                                <button id="modelGridPrev" disabled aria-label="Previous page">â€¹</button>
                                <span class="pagination-info" id="modelGridInfo">0-0 of 0</span>
                                <button id="modelGridNext" disabled aria-label="Next page">â€º</button>
                            </div>
                        </div>
                        <div class="search-results-info" id="modelSearchResults" style="display: none;"></div>
                        <div class="table-container">
                            <table id="modelTable" class="data-grid-table">
                                <thead>
                                    <tr>
                                        <th scope="col" data-column="name" class="sortable-header">Model Name</th>
                                        <th scope="col" data-column="requiredFilaments" class="sortable-header">Required Filaments</th>
                                        <th scope="col" data-column="canPrint" class="sortable-header">Can Print?</th>
                                        <th scope="col" data-column="link" class="sortable-header">Link/Notes</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="modelTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="prints-page" class="page">
                <h1>Print History</h1>
                <div class="section">
                    <h2>Record New Print</h2>
                    <div class="input-group">
                        <select id="printModel"><option value="">Select Model</option></select>
                        <input type="number" id="printWeight" placeholder="Total Weight Used (g)" min="0" step="0.1" readonly style="background: #f8f9fa; cursor: not-allowed;">
                        <input type="date" id="printDate">
                    </div>
                    <div style="margin-top:15px;">
                        <label style="display:block;margin-bottom:10px;font-weight:600;color:#495057;">Filaments Used:</label>
                        <div id="printFilamentsContainer"></div>
                        <button type="button" class="add-req-btn" onclick="addPrintFilament()">+ Add Filament</button>
                    </div>
                    <button onclick="addPrint()">Record Print</button>
                </div>
                <div class="section">
                    <h2>Print History</h2>
                    <table id="printTable">
                        <thead>
                            <tr><th>Date</th><th>Model</th><th>Color</th><th>Weight (g)</th><th>Action</th></tr>
                        </thead>
                        <tbody id="printTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="stats-page" class="page">
                <h1>Statistics & Analysis</h1>
                <div class="section">
                    <h2>Usage Statistics</h2>
                    <div id="usageStats"></div>
                </div>
                <div class="section">
                    <h2>Printable Models</h2>
                    <p style="color:#6b7280;margin-bottom:15px;">Models you can print with current inventory:</p>
                    <div id="printableModels"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="editFilamentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Filament</div>
            <form id="editFilamentForm" aria-label="Edit filament details">
                <div class="input-group">
                    <div class="form-group">
                        <label for="editFilamentBrand">Brand</label>
                        <input type="text" id="editFilamentBrand" name="brand" placeholder="Manufacturer" required>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentMaterialType">Material Type</label>
                        <select id="editFilamentMaterialType" name="materialType" required>
                            <option value="">Select Type...</option>
                            <option value="PLA">PLA</option>
                            <option value="PETG">PETG</option>
                            <option value="ABS">ABS</option>
                            <option value="TPU">TPU</option>
                            <option value="Other">Other (Custom)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentColor">Color Name</label>
                        <input type="text" id="editFilamentColor" name="colorName" placeholder="Color description" required>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentColorHex">Color Code</label>
                        <input type="color" id="editFilamentColorHex" name="colorHex" value="#ff5733">
                    </div>
                    <div class="form-group">
                        <label for="editFilamentDiameter">Diameter</label>
                        <select id="editFilamentDiameter" name="diameter" required>
                            <option value="1.75">1.75mm</option>
                            <option value="2.85">2.85mm</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentWeight">Weight (g)</label>
                        <input type="number" id="editFilamentWeight" name="weight" placeholder="Current weight" min="0" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentLocation">Storage Location</label>
                        <input type="text" id="editFilamentLocation" name="location" placeholder="Storage location">
                    </div>
                    <div class="form-group">
                        <label for="editFilamentPurchasePrice">Purchase Price ($/kg)</label>
                        <input type="number" id="editFilamentPurchasePrice" name="purchasePrice" placeholder="Optional price per kg" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="editFilamentInStock" name="inStock" value="true">
                            In Stock?
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <fieldset>
                        <legend>Temperature Range (Â°C)</legend>
                        <label for="editFilamentTempMin">Min Temp:</label>
                        <input type="number" id="editFilamentTempMin" name="tempMin" min="150" max="350" placeholder="150">
                        <label for="editFilamentTempMax">Max Temp:</label>
                        <input type="number" id="editFilamentTempMax" name="tempMax" min="150" max="350" placeholder="250">
                    </fieldset>
                </div>
                <div class="form-group">
                    <label for="editFilamentNotes">Notes</label>
                    <textarea id="editFilamentNotes" name="notes" rows="3" placeholder="Additional notes about this filament"></textarea>
                </div>
            </form>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeEditFilamentModal()">Cancel</button>
                <button type="button" onclick="saveEditFilament()">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="editModelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Model</div>
            <div class="input-group">
                <input type="text" id="editModelName" placeholder="Model Name">
                <input type="text" id="editModelLink" placeholder="Link/Notes">
            </div>
            <div style="margin-top:15px;">
                <label style="display:block;margin-bottom:10px;font-weight:600;color:#495057;">Required Filaments:</label>
                <div id="editRequiredFilamentsContainer"></div>
                <button type="button" class="add-req-btn" onclick="addEditFilamentRequirement()">+ Add Filament</button>
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeEditModelModal()">Cancel</button>
                <button onclick="saveEditModel()">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="editPrintModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Print Record</div>
            <div class="input-group">
                <input type="text" id="editPrintModel" placeholder="Model Name">
                <input type="text" id="editPrintColor" placeholder="Color">
                <input type="number" id="editPrintWeight" placeholder="Weight (g)" min="0" step="0.1">
                <input type="date" id="editPrintDate">
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeEditPrintModal()">Cancel</button>
                <button onclick="saveEditPrint()">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>